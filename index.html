<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Objex | Secure Messaging Platform</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --primary-yellow: #F4B942;
            --primary-yellow-hover: #E5AA33;
            --primary-glow: rgba(244, 185, 66, 0.6);
            --bg-dark: #0a0a0f;
            --bg-light: #f5f5f7;
            --card-dark: rgba(20, 20, 30, 0.85);
            --card-light: rgba(255, 255, 255, 0.95);
            --text-dark: #ffffff;
            --text-light: #1a1a1f;
            --accent-glow: rgba(244, 185, 66, 0.4);
            --border-dark: rgba(244, 185, 66, 0.3);
            --border-light: rgba(0, 0, 0, 0.1);
            --input-bg-dark: rgba(10, 10, 15, 0.6);
            --input-bg-light: rgba(245, 245, 247, 0.8);
            --error-red: #ff3b30;
            --success-green: #34c759;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            min-height: 100vh;
            background: var(--bg-dark);
            color: var(--text-dark);
            transition: all 0.4s ease;
            position: relative;
            overflow-x: hidden;
        }

        body.light-mode {
            background: var(--bg-light);
            color: var(--text-light);
        }

        /* Background Animations */
        .bg-grid {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                linear-gradient(rgba(244, 185, 66, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(244, 185, 66, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 0;
            animation: gridMove 20s linear infinite;
        }

        @keyframes gridMove {
            0% { transform: perspective(500px) rotateX(60deg) translateY(0); }
            100% { transform: perspective(500px) rotateX(60deg) translateY(50px); }
        }

        body.light-mode .bg-grid {
            background-image: 
                linear-gradient(rgba(0, 0, 0, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 0, 0, 0.03) 1px, transparent 1px);
        }

        .particles {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            width: 4px; height: 4px;
            background: var(--primary-yellow);
            border-radius: 50%;
            opacity: 0.3;
            animation: float-particle 15s infinite;
            box-shadow: 0 0 10px var(--primary-yellow);
        }

        .particle:nth-child(1) { left: 10%; top: 100%; animation-delay: 0s; animation-duration: 12s; }
        .particle:nth-child(2) { left: 30%; top: 100%; animation-delay: 2s; animation-duration: 18s; }
        .particle:nth-child(3) { left: 50%; top: 100%; animation-delay: 4s; animation-duration: 14s; }
        .particle:nth-child(4) { left: 70%; top: 100%; animation-delay: 6s; animation-duration: 16s; }
        .particle:nth-child(5) { left: 90%; top: 100%; animation-delay: 8s; animation-duration: 13s; }

        @keyframes float-particle {
            0% { transform: translateY(0) rotate(0deg); opacity: 0; }
            10% { opacity: 0.3; }
            90% { opacity: 0.3; }
            100% { transform: translateY(-100vh) rotate(720deg); opacity: 0; }
        }

        .orb {
            position: fixed;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.3;
            z-index: 0;
            animation: orb-pulse 8s ease-in-out infinite;
        }

        .orb-1 {
            width: 400px; height: 400px;
            background: radial-gradient(circle, var(--primary-yellow) 0%, transparent 70%);
            top: -100px; right: -100px;
            animation-delay: 0s;
        }

        .orb-2 {
            width: 300px; height: 300px;
            background: radial-gradient(circle, var(--primary-yellow) 0%, transparent 70%);
            bottom: -50px; left: -50px;
            animation-delay: 4s;
        }

        @keyframes orb-pulse {
            0%, 100% { transform: scale(1); opacity: 0.3; }
            50% { transform: scale(1.2); opacity: 0.5; }
        }

        /* Navigation */
        nav {
            position: fixed;
            top: 0; width: 100%;
            padding: 20px 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            background: rgba(10, 10, 15, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(244, 185, 66, 0.1);
            transition: all 0.4s ease;
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from { transform: translateY(-100%); }
            to { transform: translateY(0); }
        }

        body.light-mode nav {
            background: rgba(255, 255, 255, 0.9);
            border-bottom-color: rgba(0, 0, 0, 0.1);
        }

        .nav-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 24px;
            font-weight: 800;
            text-decoration: none;
            color: var(--text-dark);
            transition: all 0.3s ease;
        }

        .nav-logo:hover { transform: scale(1.05); }
        body.light-mode .nav-logo { color: var(--text-light); }
        .nav-logo span { color: var(--primary-yellow); text-shadow: 0 0 10px var(--primary-glow); }

        .logo-icon {
            width: 40px; height: 40px;
            background: linear-gradient(135deg, #F4B942 0%, #FFD700 100%);
            background-size: 200% 200%;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            animation: gradient-shift 3s ease infinite;
            box-shadow: 0 4px 15px rgba(244, 185, 66, 0.4);
        }

        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .shield {
            width: 20px; height: 24px;
            background: #0a0a0f;
            clip-path: polygon(50% 0%, 100% 25%, 100% 65%, 50% 100%, 0% 65%, 0% 25%);
            position: relative;
        }

        .shield::after {
            content: '';
            position: absolute;
            width: 50%; height: 100%;
            right: 0;
            background: rgba(244, 185, 66, 0.3);
            clip-path: polygon(100% 0%, 100% 100%, 0% 100%, 0% 0%);
        }

        .theme-toggle {
            background: var(--card-dark);
            border: 1px solid var(--border-dark);
            border-radius: 50px;
            padding: 8px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            color: var(--text-dark);
            font-family: inherit;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        body.light-mode .theme-toggle {
            background: var(--card-light);
            border-color: var(--border-light);
            color: var(--text-light);
        }

        .theme-toggle:hover {
            transform: scale(1.05) translateY(-2px);
            box-shadow: 0 0 30px var(--accent-glow);
            border-color: var(--primary-yellow);
        }

        .theme-icon { font-size: 18px; transition: transform 0.3s ease; }
        .theme-toggle:hover .theme-icon { transform: rotate(180deg); }

        .nav-right { display: flex; align-items: center; gap: 15px; }
        
        .session-timer {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(244, 185, 66, 0.1);
            border: 1px solid var(--border-dark);
            padding: 8px 15px;
            border-radius: 50px;
            font-size: 14px;
            font-weight: 600;
            color: var(--primary-yellow);
            transition: all 0.3s ease;
        }

        .session-timer:hover { transform: scale(1.05); box-shadow: 0 0 20px var(--accent-glow); }
        body.light-mode .session-timer {
            background: rgba(244, 185, 66, 0.05);
            border-color: var(--border-light);
        }

        .timer-display { font-variant-numeric: tabular-nums; min-width: 50px; text-align: center; }
        .timer-low { color: #ff3b30; animation: pulse 1s infinite; }
        
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            color: var(--primary-yellow);
        }

        .logout-btn {
            background: none;
            border: 1px solid var(--border-dark);
            color: var(--text-dark);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        body.light-mode .logout-btn {
            border-color: var(--border-light);
            color: var(--text-light);
        }

        .logout-btn::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: rgba(255, 59, 48, 0.1);
            transition: left 0.3s ease;
            z-index: -1;
        }

        .logout-btn:hover::before { left: 0; }
        .logout-btn:hover { border-color: #ff3b30; color: #ff3b30; transform: translateY(-2px); }

        /* Containers */
        .container {
            position: relative;
            z-index: 10;
            max-width: 1200px;
            margin: 100px auto 40px;
            padding: 20px;
        }

        .center-container {
            position: relative;
            z-index: 10;
            width: 100%;
            max-width: 480px;
            margin: 100px auto;
            padding: 20px;
        }

        /* Views */
        .view { display: none; animation: fadeIn 0.6s ease-out; }
        .view.active { display: block; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background: var(--card-dark);
            border: 1px solid var(--border-dark);
            border-radius: 24px;
            padding: 40px;
            backdrop-filter: blur(20px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(244, 185, 66, 0.1);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: -2px; left: -2px; right: -2px; bottom: -2px;
            background: linear-gradient(45deg, transparent, var(--primary-yellow), transparent);
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
            border-radius: 26px;
        }

        .card:hover::before { opacity: 0.2; animation: border-glow 2s linear infinite; }
        
        @keyframes border-glow {
            0%, 100% { filter: blur(10px); }
            50% { filter: blur(20px); }
        }

        body.light-mode .card {
            background: var(--card-light);
            border-color: var(--border-light);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
        }

        .card:hover { transform: translateY(-5px); box-shadow: 0 30px 60px -12px rgba(0, 0, 0, 0.6), 0 0 30px rgba(244, 185, 66, 0.2); }

        .card-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-dark);
        }

        body.light-mode .card-header { border-bottom-color: var(--border-light); }
        
        .card-icon {
            width: 50px; height: 50px;
            background: linear-gradient(135deg, rgba(244, 185, 66, 0.2) 0%, rgba(244, 185, 66, 0.1) 100%);
            border: 1px solid var(--border-dark);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.3s ease;
        }

        .card:hover .card-icon { transform: scale(1.1) rotate(5deg); background: linear-gradient(135deg, rgba(244, 185, 66, 0.3) 0%, rgba(244, 185, 66, 0.2) 100%); }
        
        .card-title h2 { font-size: 24px; margin-bottom: 5px; }
        .card-title p { font-size: 14px; opacity: 0.6; }

        /* Forms */
        .form-group { margin-bottom: 24px; position: relative; }
        
        .form-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
            color: var(--primary-yellow);
            transition: all 0.3s ease;
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--border-dark);
            border-radius: 12px;
            background: var(--input-bg-dark);
            color: var(--text-dark);
            font-size: 16px;
            font-family: inherit;
            transition: all 0.3s ease;
            outline: none;
        }

        body.light-mode .form-input, body.light-mode .form-textarea {
            background: var(--input-bg-light);
            color: var(--text-light);
            border-color: var(--border-light);
        }

        .form-input:focus, .form-textarea:focus {
            border-color: var(--primary-yellow);
            box-shadow: 0 0 0 4px var(--accent-glow), 0 0 20px var(--primary-glow);
            transform: translateY(-2px);
        }

        .form-input.error { border-color: var(--error-red); box-shadow: 0 0 0 4px rgba(255, 59, 48, 0.2); }
        
        .form-textarea { resize: vertical; min-height: 150px; }
        
        .error-message {
            color: var(--error-red);
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }
        
        .error-message.show { display: block; }

        .char-counter { text-align: right; font-size: 12px; opacity: 0.5; margin-top: 5px; }

        /* Buttons */
        .btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #F4B942 0%, #E5AA33 50%, #F4B942 100%);
            background-size: 200% 200%;
            color: #0a0a0f;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(244, 185, 66, 0.3);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s ease;
        }

        .btn:hover::before { left: 100%; }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(244, 185, 66, 0.5), 0 0 40px rgba(244, 185, 66, 0.3); animation: gradient-shift 2s ease infinite; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

        .btn-secondary {
            background: transparent;
            border: 2px solid var(--border-dark);
            color: var(--text-dark);
            margin-top: 15px;
        }

        body.light-mode .btn-secondary { border-color: var(--border-light); color: var(--text-light); }
        .btn-secondary:hover { border-color: var(--primary-yellow); background: rgba(244, 185, 66, 0.1); box-shadow: 0 0 30px var(--accent-glow); }

        /* Page Headers */
        .page-header { margin-bottom: 40px; animation: fadeIn 0.6s ease-out; }
        .page-header h1 { font-size: 42px; margin-bottom: 10px; font-weight: 800; display: flex; align-items: center; gap: 15px; }
        .page-header p { font-size: 18px; opacity: 0.7; }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 1px solid var(--border-dark);
            padding-bottom: 0;
        }

        body.light-mode .tabs { border-bottom-color: var(--border-light); }
        
        .tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            color: var(--text-dark);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.6;
        }

        body.light-mode .tab { color: var(--text-light); }
        .tab:hover { opacity: 1; color: var(--primary-yellow); }
        .tab.active { opacity: 1; color: var(--primary-yellow); border-bottom-color: var(--primary-yellow); }

        /* Content Grid */
        .content-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        
        @media (max-width: 968px) {
            .content-grid { grid-template-columns: 1fr; }
            nav { padding: 15px 20px; }
            .page-header h1 { font-size: 28px; }
        }

        /* Lists */
        .recipients-list { max-height: 300px; overflow-y: auto; }
        
        .recipient-item {
            background: rgba(244, 185, 66, 0.05);
            border: 1px solid var(--border-dark);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        body.light-mode .recipient-item { background: rgba(244, 185, 66, 0.03); border-color: var(--border-light); }
        .recipient-item:hover { border-color: var(--primary-yellow); transform: translateX(5px); }
        
        .recipient-info { display: flex; flex-direction: column; gap: 5px; }
        .recipient-phone { font-weight: 600; font-size: 16px; }
        .recipient-code { font-size: 12px; color: var(--primary-yellow); font-family: monospace; }
        .recipient-checkbox { width: 24px; height: 24px; accent-color: var(--primary-yellow); cursor: pointer; }

        .empty-state { text-align: center; padding: 60px 20px; opacity: 0.5; }
        .empty-icon { font-size: 48px; margin-bottom: 15px; animation: bounce 2s infinite; }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .message-history { max-height: 400px; overflow-y: auto; }
        
        .message-item {
            background: rgba(244, 185, 66, 0.05);
            border: 1px solid var(--border-dark);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            animation: slideIn 0.3s ease-out;
        }

        body.light-mode .message-item { background: rgba(244, 185, 66, 0.03); border-color: var(--border-light); }
        
        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .message-status {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #34c759;
            font-weight: 600;
        }

        .message-status.failed { color: #ff3b30; }
        
        .message-content {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.5;
            border-left: 3px solid var(--primary-yellow);
        }

        body.light-mode .message-content { background: rgba(0, 0, 0, 0.05); }
        
        .safety-prefix { color: var(--primary-yellow); font-weight: 700; }

        /* Safety Notices */
        .safety-notice {
            background: rgba(244, 185, 66, 0.1);
            border: 1px solid var(--border-dark);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: fadeIn 0.3s ease-out;
        }

        body.light-mode .safety-notice { background: rgba(244, 185, 66, 0.05); border-color: var(--border-light); }
        .safety-notice .icon { color: var(--primary-yellow); font-size: 20px; }

        .spam-notice {
            background: rgba(244, 185, 66, 0.05);
            border: 1px solid var(--border-dark);
            border-radius: 12px;
            padding: 16px;
            margin-top: 20px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            font-size: 13px;
            animation: fadeIn 0.5s ease;
        }

        body.light-mode .spam-notice { background: rgba(244, 185, 66, 0.03); border-color: var(--border-light); }

        /* URL Box */
        .url-box {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-dark);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
        }

        body.light-mode .url-box { background: rgba(0, 0, 0, 0.05); border-color: var(--border-light); }
        
        .url-text {
            font-family: monospace;
            font-size: 13px;
            color: var(--primary-yellow);
            word-break: break-all;
        }

        .btn-copy {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-dark);
            color: var(--text-dark);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
            transition: all 0.3s ease;
        }

        body.light-mode .btn-copy { background: rgba(0, 0, 0, 0.1); border-color: var(--border-light); color: var(--text-light); }
        .btn-copy:hover { background: var(--primary-yellow); color: #0a0a0f; border-color: var(--primary-yellow); }

        /* Tables */
        .users-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        
        .users-table th, .users-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-dark);
        }

        body.light-mode .users-table th, body.light-mode .users-table td { border-bottom-color: var(--border-light); }
        .users-table th { color: var(--primary-yellow); font-size: 12px; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; }
        .users-table tr:hover { background: rgba(244, 185, 66, 0.05); }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 50px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-new { background: rgba(52, 199, 89, 0.2); color: #34c759; }
        .status-sent { background: rgba(244, 185, 66, 0.2); color: var(--primary-yellow); }

        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(10px);
        }

        .modal-overlay.show { display: flex; }
        
        .modal {
            background: var(--card-dark);
            border: 1px solid var(--border-dark);
            border-radius: 24px;
            padding: 40px;
            max-width: 400px;
            text-align: center;
            animation: modalSlide 0.3s ease;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5), 0 0 40px rgba(244, 185, 66, 0.3);
        }

        @keyframes modalSlide {
            from { opacity: 0; transform: scale(0.9) translateY(20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .modal-icon { font-size: 64px; margin-bottom: 20px; animation: pulse 2s infinite; }
        .modal h2 { margin-bottom: 10px; color: #ff3b30; }
        .modal p { margin-bottom: 25px; opacity: 0.7; }

        /* Success States */
        .success-state { display: none; text-align: center; animation: fadeIn 0.5s ease; }
        .success-state.show { display: block; }
        .success-icon { font-size: 64px; margin-bottom: 20px; }
        
        .phone-preview {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-dark);
            border-radius: 16px;
            padding: 20px;
            margin: 25px 0;
            text-align: left;
            position: relative;
        }

        body.light-mode .phone-preview { background: rgba(0, 0, 0, 0.05); border-color: var(--border-light); }
        
        .phone-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--primary-yellow);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .phone-screen {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 14px;
            line-height: 1.4;
            border-left: 3px solid var(--success-green);
        }

        body.light-mode .phone-screen { background: rgba(255, 255, 255, 0.8); color: #1a1a1f; }

        /* Spinner */
        .spinner {
            width: 20px; height: 20px;
            border: 3px solid rgba(10, 10, 15, 0.3);
            border-radius: 50%;
            border-top-color: #0a0a0f;
            animation: spin 1s ease-in-out infinite;
            display: none;
        }

        @keyframes spin { to { transform: rotate(360deg); } }
        .btn.loading .spinner { display: inline-block; }
        .btn.loading .btn-text { display: none; }

        /* Demo Specific */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(244, 185, 66, 0.1);
            border: 1px solid var(--border-dark);
            padding: 6px 12px;
            border-radius: 50px;
            font-size: 11px;
            color: var(--primary-yellow);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .hint { font-size: 12px; opacity: 0.6; margin-top: 6px; display: block; }
        
        .meeting-cta {
            background: rgba(244, 185, 66, 0.1);
            border: 1px solid var(--border-dark);
            border-radius: 12px;
            padding: 20px;
            margin-top: 25px;
            text-align: center;
        }

        body.light-mode .meeting-cta { background: rgba(244, 185, 66, 0.05); border-color: var(--border-light); }
        .meeting-cta h3 { font-size: 18px; margin-bottom: 10px; color: var(--primary-yellow); }
        .meeting-cta p { font-size: 14px; margin-bottom: 15px; opacity: 0.8; }
        
        .calendly-link {
            color: var(--primary-yellow);
            text-decoration: none;
            font-weight: 600;
            border-bottom: 1px solid var(--primary-yellow);
            padding-bottom: 2px;
            transition: all 0.3s;
        }

        .calendly-link:hover { opacity: 0.8; }

        /* Center specific */
        .centered-layout {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .logo-center {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo-center .logo-icon {
            width: 60px; height: 60px;
            margin: 0 auto 15px;
            border-radius: 16px;
        }

        .logo-center .shield { width: 30px; height: 36px; }
        .tagline { font-size: 13px; color: rgba(255, 255, 255, 0.6); letter-spacing: 2px; text-transform: uppercase; margin-top: 8px; }
        body.light-mode .tagline { color: rgba(0, 0, 0, 0.5); }

        .input-icon {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0.5;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .form-input:focus + .input-icon { opacity: 1; color: var(--primary-yellow); transform: translateY(-50%) scale(1.1); }
        
        .input-wrapper { position: relative; }

        .security-badge {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: rgba(244, 185, 66, 0.1);
            border: 1px solid var(--border-dark);
            border-radius: 10px;
            margin-bottom: 24px;
            font-size: 12px;
            animation: fadeIn 0.6s ease-out 0.8s both;
            transition: all 0.3s ease;
        }

        body.light-mode .security-badge { background: rgba(244, 185, 66, 0.05); }
        .security-badge:hover { background: rgba(244, 185, 66, 0.15); transform: translateX(5px); }
        .security-badge .icon { color: var(--primary-yellow); font-size: 16px; animation: shield-rotate 3s ease-in-out infinite; }
        
        @keyframes shield-rotate {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(5deg); }
            75% { transform: rotate(-5deg); }
        }

        .security-footer {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border-dark);
            text-align: center;
            font-size: 12px;
            opacity: 0.6;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        body.light-mode .security-footer { border-top-color: var(--border-light); }

        .invalid-session { display: none; text-align: center; padding: 40px 20px; }
        .invalid-session.show { display: block; }
        .invalid-session h2 { color: var(--error-red); margin-bottom: 15px; }

        /* SMS Preview in Capture */
        .sms-preview {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-dark);
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
            text-align: left;
            font-family: monospace;
            font-size: 13px;
        }

        body.light-mode .sms-preview { background: rgba(0, 0, 0, 0.05); border-color: var(--border-light); }
        
        .sms-header {
            color: var(--primary-yellow);
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 11px;
            text-transform: uppercase;
        }

        .sms-content { color: var(--text-dark); line-height: 1.4; }
        body.light-mode .sms-content { color: var(--text-light); }

        .lock-icon { color: var(--primary-yellow); animation: lock-pulse 2s infinite; }
        @keyframes lock-pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }

        .error-banner {
            background: rgba(255, 59, 48, 0.1);
            border: 1px solid rgba(255, 59, 48, 0.3);
            color: #ff3b30;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
            align-items: center;
            gap: 8px;
            animation: shake 0.5s ease;
        }

        .error-banner.show { display: flex; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
    </style>
</head>
<body>
    <div class="bg-grid"></div>
    <div class="particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>

    <!-- Navigation (shown only in dashboard) -->
    <nav id="mainNav" style="display: none;">
        <a href="#" class="nav-logo" onclick="return false;">
            <div class="logo-icon"><div class="shield"></div></div>
            Mobile<span>Objex</span>
        </a>
        <div class="nav-right">
            <div class="session-timer" id="sessionTimer">
                <span>‚è±Ô∏è</span>
                <span class="timer-display" id="timerDisplay">30:00</span>
            </div>
            <div class="user-info">
                <span id="usernameDisplay"></span>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
            <button class="theme-toggle" onclick="toggleTheme()">
                <span class="theme-icon" id="themeIcon">üåô</span>
                <span id="themeText">Dark</span>
            </button>
        </div>
    </nav>

    <!-- VIEW 1: LOGIN -->
    <div id="loginView" class="view centered-layout active">
        <div class="center-container">
            <div class="logo-center">
                <div class="logo-icon"><div class="shield"></div></div>
                <div class="logo-text" style="font-size: 28px; font-weight: 800;">Mobile<span style="color: var(--primary-yellow);">Objex</span></div>
                <div class="tagline">Secure Mobile Messaging</div>
            </div>

            <div class="card">
                <div class="card-header" style="border-bottom: none; justify-content: center;">
                    <div style="text-align: center; width: 100%;">
                        <h2 style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                            <span class="lock-icon">üîí</span> Secure Access
                        </h2>
                        <p style="opacity: 0.7; margin-top: 8px;">Enter credentials to access the platform</p>
                    </div>
                </div>

                <div class="error-banner" id="loginError">
                    <span>‚ö†Ô∏è</span>
                    <span>Invalid credentials. Please try again.</span>
                </div>

                <form id="loginForm" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label class="form-label">MO Username</label>
                        <div class="input-wrapper">
                            <input type="text" class="form-input" id="loginUsername" placeholder="Enter your MO username" required autocomplete="off">
                            <span class="input-icon">üë§</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">MO Password</label>
                        <div class="input-wrapper">
                            <input type="password" class="form-input" id="loginPassword" placeholder="Enter your secure password" required>
                            <span class="input-icon">üîê</span>
                        </div>
                    </div>

                    <div class="security-badge">
                        <span class="icon">üõ°Ô∏è</span>
                        <span>End-to-end encryption active ‚Ä¢ Session expires in 30 minutes</span>
                    </div>

                    <button type="submit" class="btn" id="loginBtn">
                        <span class="spinner"></span>
                        <span class="btn-text">Access Platform</span>
                    </button>
                </form>

                <div class="security-footer">
                    <span>üõ°Ô∏è</span>
                    <span>Protected by Mobile Objex Secure Infrastructure</span>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="theme-toggle" onclick="toggleTheme()" style="position: static; display: inline-flex;">
                    <span class="theme-icon" id="loginThemeIcon">üåô</span>
                    <span id="loginThemeText">Dark</span>
                </button>
            </div>
        </div>
    </div>

    <!-- VIEW 2: DASHBOARD/SEND -->
    <div id="dashboardView" class="view">
        <div class="container">
            <div class="page-header">
                <h1>üì§ Message Center</h1>
                <p>Secure Messaging Dashboard - Manage recipients and send verified messages</p>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="switchTab('users')" id="tab-users">Users</button>
                <button class="tab" onclick="switchTab('campaign')" id="tab-campaign">Campaign</button>
            </div>

            <!-- Users Tab -->
            <div id="content-users" class="tab-content active">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üë•</div>
                        <div class="card-title">
                            <h2>Registered Users</h2>
                            <p id="usersCount">No users registered</p>
                        </div>
                    </div>

                    <div class="url-box">
                        <div class="url-text" id="shortUrl">Loading...</div>
                        <button class="btn-copy" onclick="copyUrl()">Copy Link</button>
                    </div>

                    <div id="usersTableContainer">
                        <div class="empty-state">
                            <div class="empty-icon">üì≠</div>
                            <p>No users registered in this session</p>
                            <p style="font-size: 12px; margin-top: 10px;">Share the link above to add users</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Campaign Tab -->
            <div id="content-campaign" class="tab-content">
                <div class="content-grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üì±</div>
                            <div class="card-title">
                                <h2>Select Recipients</h2>
                                <p id="recipientCount">No recipients available</p>
                            </div>
                        </div>

                        <div class="recipients-list" id="recipientsList">
                            <div class="empty-state">
                                <div class="empty-icon">üì≠</div>
                                <p>No recipients captured in this session</p>
                            </div>
                        </div>

                        <div class="card-header" style="margin-top: 20px;">
                            <div class="card-icon">‚úâÔ∏è</div>
                            <div class="card-title">
                                <h2>Compose Message</h2>
                                <p>SMS will be sent with Safety Code prefix</p>
                            </div>
                        </div>

                        <div class="safety-notice">
                            <span class="icon">üõ°Ô∏è</span>
                            <span><strong>Safety Code Protection:</strong> Safety code will be automatically prefixed to all messages.</span>
                        </div>

                        <form id="sendForm" onsubmit="handleSend(event)">
                            <div class="form-group">
                                <label class="form-label">Message Content *</label>
                                <textarea class="form-textarea" id="messageContent" placeholder="Enter your secure message here..." maxlength="1600" required></textarea>
                                <div class="char-counter">
                                    <span id="charCount">0</span> / 1600 characters
                                </div>
                            </div>

                            <div class="safety-notice" style="margin-bottom: 20px;">
                                <span class="icon">üëÅÔ∏è</span>
                                <div>
                                    <strong>Preview:</strong><br>
                                    <span id="previewText" style="font-family: monospace; font-size: 13px;">
                                        <span style="color: var(--primary-yellow); font-weight: 700;">[SafetyCode]</span> Your message will appear here...
                                    </span>
                                </div>
                            </div>

                            <button type="submit" class="btn" id="sendBtn" disabled>
                                <span>üöÄ</span>
                                Send Secure Message
                            </button>
                        </form>

                        <div class="spam-notice">
                            <span style="font-size: 20px; flex-shrink: 0;">üìß</span>
                            <div>
                                <strong style="color: var(--primary-yellow); display: block; margin-bottom: 4px;">Didn't receive the message?</strong>
                                <span style="opacity: 0.8;">If you did not receive the text message, please check your spam folder.</span>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">üì®</div>
                            <div class="card-title">
                                <h2>Message History</h2>
                                <p id="messageCount">No messages sent</p>
                            </div>
                        </div>

                        <div class="message-history" id="messageHistory">
                            <div class="empty-state">
                                <div class="empty-icon">üì§</div>
                                <p>No messages sent yet</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- VIEW 3: CAPTURE (Registration) -->
    <div id="captureView" class="view centered-layout">
        <div class="center-container">
            <div class="logo-center" style="position: fixed; top: 30px; left: 50%; transform: translateX(-50%); z-index: 100;">
                <div class="logo-icon" style="width: 50px; height: 50px; margin: 0 auto 10px;">
                    <div class="shield" style="width: 24px; height: 30px;"></div>
                </div>
                <div class="logo-text" style="font-size: 20px;">Mobile<span>Objex</span></div>
            </div>

            <div class="card invalid-session" id="invalidSession" style="margin-top: 100px;">
                <div class="card-header" style="justify-content: center; border-bottom: none;">
                    <div style="text-align: center;">
                        <h2>‚ö†Ô∏è Invalid Link</h2>
                        <p style="margin-top: 10px;">This registration link is invalid or has expired.</p>
                    </div>
                </div>
            </div>

            <div class="card" id="registrationForm" style="margin-top: 100px;">
                <div class="card-header" style="justify-content: center; border-bottom: none;">
                    <div style="text-align: center; width: 100%;">
                        <h1>Secure Registration</h1>
                        <p style="margin-top: 8px; opacity: 0.7;">Enter your mobile number and safety code to receive verified messages.</p>
                    </div>
                </div>

                <form id="captureForm">
                    <div class="form-group">
                        <label class="form-label">Mobile Number *</label>
                        <input type="tel" class="form-input" id="capPhone" placeholder="(555) 000-0000" required maxlength="14">
                        <div class="error-message" id="phoneError">Phone numbers do not match</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Confirm Mobile Number *</label>
                        <input type="tel" class="form-input" id="capPhoneConfirm" placeholder="Confirm phone number" required maxlength="14">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Safety Code *</label>
                        <input type="text" class="form-input" id="capCode" placeholder="4-6 characters (e.g., shark123)" required minlength="4" maxlength="6">
                        <div class="error-message" id="codeError">Safety codes do not match</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Confirm Safety Code *</label>
                        <input type="text" class="form-input" id="capCodeConfirm" placeholder="Confirm safety code" required minlength="4" maxlength="6">
                    </div>

                    <button type="submit" class="btn" id="capSubmitBtn">Complete Registration</button>
                </form>

                <div class="security-footer">
                    <span>üõ°Ô∏è</span>
                    <span>Secured by Mobile Objex ‚Ä¢ End-to-end encrypted</span>
                </div>
            </div>

            <div class="card success-state" id="captureSuccess" style="margin-top: 100px;">
                <div class="success-icon">‚úÖ</div>
                <h2>Registration Complete</h2>
                <p>Your information has been securely stored. You will receive a confirmation SMS shortly.</p>
                
                <div class="spam-notice" style="text-align: left; margin: 20px 0;">
                    <span style="font-size: 20px;">üìß</span>
                    <div>
                        <strong style="color: var(--primary-yellow); font-size: 13px; text-transform: uppercase;">Didn't receive the message?</strong>
                        <p style="margin: 4px 0 0 0; font-size: 13px; opacity: 0.8;">If you did not receive the text message, please check your spam folder.</p>
                    </div>
                </div>
                
                <div class="sms-preview">
                    <div class="sms-header">üì± Confirmation SMS Preview</div>
                    <div class="sms-content" id="smsPreviewContent">
                        <span style="color: var(--primary-yellow); font-weight: 700;">[Your Safety Code]</span> Thank you for registering with Mobile Objex. Your secure messaging is now active.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- VIEW 4: DEMO -->
    <div id="demoView" class="view centered-layout">
        <div class="center-container">
            <button class="theme-toggle" onclick="toggleTheme()" style="position: fixed; top: 20px; right: 20px;">
                <span class="theme-icon" id="demoThemeIcon">üåô</span>
                <span id="demoThemeText">Dark</span>
            </button>

            <div class="logo-center">
                <div class="logo-icon" style="width: 60px; height: 60px; border-radius: 16px;">
                    <div class="shield" style="width: 30px; height: 36px;"></div>
                </div>
                <div class="logo-text" style="font-size: 24px;">Mobile<span>Objex</span></div>
                <div class="tagline">Secure Mobile Messaging</div>
            </div>

            <div class="card" id="demoFormCard">
                <div class="card-header" style="justify-content: center; border-bottom: none;">
                    <div style="text-align: center; width: 100%;">
                        <div class="badge" style="display: inline-flex;">
                            <span>üõ°Ô∏è</span>
                            <span>Secure Access</span>
                        </div>
                        <h1>Secure Message Verification</h1>
                        <p style="margin-top: 10px; opacity: 0.7;">Register your mobile number to receive verified secure messages with your personal Safe Key prefix.</p>
                    </div>
                </div>

                <form id="demoForm" onsubmit="handleDemoSubmit(event)">
                    <div class="form-group">
                        <label class="form-label">Mobile Number *</label>
                        <input type="tel" class="form-input" id="demoPhone" placeholder="(555) 000-0000" required maxlength="14">
                        <span class="hint">Enter your US mobile number to receive the secure message</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Your Safe Key *</label>
                        <input type="text" class="form-input" id="demoCode" placeholder="e.g., Alpha1" required minlength="4" maxlength="6">
                        <span class="hint">Create a 4-6 character code to see how it prefixes your message</span>
                    </div>

                    <button type="submit" class="btn" id="demoBtn">
                        <span class="spinner"></span>
                        <span class="btn-text">üì± Send Secure Message</span>
                    </button>
                </form>

                <div class="security-footer">
                    <span>üõ°Ô∏è</span>
                    <span>End-to-end encrypted ‚Ä¢ Direct secure access</span>
                </div>
            </div>

            <div class="card success-state" id="demoSuccess">
                <div class="success-icon">‚úÖ</div>
                <h2>Message Sent Successfully</h2>
                <p>Check your phone! You've received a secure message demonstrating how Mobile Objex verifies legitimate communications.</p>
                
                <div class="spam-notice" style="text-align: left; margin: 20px 0;">
                    <span style="font-size: 20px;">üìß</span>
                    <div>
                        <strong style="color: var(--primary-yellow); font-size: 13px; text-transform: uppercase;">Didn't receive the message?</strong>
                        <p style="margin: 4px 0 0 0; font-size: 13px; opacity: 0.8;">If you did not receive the text message, please check your spam folder.</p>
                    </div>
                </div>
                
                <div class="phone-preview">
                    <div class="phone-header">
                        <span>üì±</span>
                        <span>MESSAGE PREVIEW</span>
                    </div>
                    <div class="phone-screen" id="demoPreview">
                        <span class="safety-prefix" id="demoPreviewCode">[Your Safe Key]</span> 
                        This is how verified messages from Mobile Objex appear. The Safe Key prefix authenticates legitimate communications and stops scams before they reach consumers.
                    </div>
                </div>

                <div class="meeting-cta">
                    <h3>Interested in Learning More?</h3>
                    <p>See how Mobile Objex can protect your organization's mobile communications.</p>
                    <a href="https://calendly.com/mobile-objex" target="_blank" class="calendly-link">Schedule a Meeting ‚Üí</a>
                </div>

                <button class="btn btn-secondary" onclick="resetDemo()">Send Another Message</button>
            </div>
        </div>
    </div>

    <!-- Session Expired Modal -->
    <div class="modal-overlay" id="expiredModal">
        <div class="modal">
            <div class="modal-icon">‚è∞</div>
            <h2>Session Expired</h2>
            <p>Your session has expired for security reasons. All data has been purged.</p>
            <button class="btn" onclick="logout()">Return to Login</button>
        </div>
    </div>

    <script>
        // Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDnh2nrtoZVWo-_KYhNIjzmsplE5c_olUw",
            authDomain: "mobile-objex.firebaseapp.com",
            projectId: "mobile-objex",
            storageBucket: "mobile-objex.firebasestorage.app",
            messagingSenderId: "875499185931",
            appId: "1:875499185931:web:6f90c12f6a69649065640e"
        };

        // TextBelt Configuration
        const TEXTBELT_KEY = "b88f3bc5c28e511ec230fa8b46c2289634e0604dIpPA4CpHdZu853Iddph9p2gI1";
        const TEXTBELT_URL = "https://textbelt.com/text";

        // Hardcoded Users
        const MO_USERS = [
            { username: 'admin', password: 'admin123', name: 'Administrator' },
            { username: 'cmchen', password: 'CmChen123', name: 'Cm Chen' },
            { username: 'annesullivan', password: 'Sullivan123', name: 'Anne Sullivan' },
            { username: 'mpellegrino', password: 'Pellegrino123', name: 'Michael Pellegrino' }
        ];

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // State
        let currentSession = null;
        let sessionId = null;
        let usersListener = null;
        let timerInterval = null;
        let expiryTime = null;

        // Router
        function router() {
            const hash = window.location.hash || '#login';
            const urlParams = new URLSearchParams(window.location.search);
            const sessionParam = urlParams.get('s');

            // Hide all views
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById('mainNav').style.display = 'none';

            if (hash === '#capture' || sessionParam) {
                // Capture/Registration view
                if (sessionParam) window.location.hash = '#capture';
                document.getElementById('captureView').classList.add('active');
                initCapture();
            } else if (hash === '#demo') {
                // Demo view
                document.getElementById('demoView').classList.add('active');
                initDemo();
            } else if (hash === '#dashboard') {
                // Dashboard (check auth)
                checkAuth().then(authed => {
                    if (authed) {
                        document.getElementById('dashboardView').classList.add('active');
                        document.getElementById('mainNav').style.display = 'flex';
                        initDashboard();
                    } else {
                        window.location.hash = '#login';
                    }
                });
            } else {
                // Login view
                document.getElementById('loginView').classList.add('active');
                checkExistingSession();
            }
        }

        // Theme Toggle
        function toggleTheme() {
            const body = document.body;
            body.classList.toggle('light-mode');
            const isLight = body.classList.contains('light-mode');
            const icon = isLight ? '‚òÄÔ∏è' : 'üåô';
            const text = isLight ? 'Light' : 'Dark';
            
            // Update all theme toggles
            document.querySelectorAll('.theme-icon').forEach(el => el.textContent = icon);
            document.querySelectorAll('#themeText, #loginThemeText, #demoThemeText').forEach(el => el.textContent = text);
            
            localStorage.setItem('theme', isLight ? 'light' : 'dark');
        }

        function loadTheme() {
            if (localStorage.getItem('theme') === 'light') {
                document.body.classList.add('light-mode');
                document.querySelectorAll('.theme-icon').forEach(el => el.textContent = '‚òÄÔ∏è');
                document.querySelectorAll('#themeText, #loginThemeText, #demoThemeText').forEach(el => el.textContent = 'Light');
            }
        }

        // Login Functions
        async function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            const btn = document.getElementById('loginBtn');
            const error = document.getElementById('loginError');
            
            btn.classList.add('loading');
            btn.disabled = true;
            
            await new Promise(r => setTimeout(r, 800));
            
            const user = MO_USERS.find(u => u.username === username && u.password === password);
            
            if (user) {
                sessionId = 'sess_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                const expiresAt = new Date(Date.now() + 30 * 60 * 1000);
                
                const sessionData = {
                    mo_username: user.username,
                    name: user.name,
                    sessionId: sessionId,
                    expiresAt: expiresAt.toISOString(),
                    active: true,
                    captureUrl: window.location.origin + window.location.pathname + '#capture?s=' + sessionId
                };
                
                try {
                    await db.collection('sessions').doc(sessionId).set({
                        ...sessionData,
                        loginTime: firebase.firestore.Timestamp.now(),
                        expiresAt: firebase.firestore.Timestamp.fromDate(expiresAt)
                    });
                    
                    localStorage.setItem('mo_current_session', JSON.stringify(sessionData));
                    window.location.hash = '#dashboard';
                } catch (err) {
                    console.error(err);
                    alert('Database error');
                }
            } else {
                error.classList.add('show');
                setTimeout(() => error.classList.remove('show'), 3000);
            }
            
            btn.classList.remove('loading');
            btn.disabled = false;
        }

        async function checkExistingSession() {
            const saved = localStorage.getItem('mo_current_session');
            if (saved) {
                try {
                    const session = JSON.parse(saved);
                    const doc = await db.collection('sessions').doc(session.sessionId).get();
                    if (doc.exists && doc.data().active && new Date(session.expiresAt) > new Date()) {
                        window.location.hash = '#dashboard';
                    } else {
                        localStorage.removeItem('mo_current_session');
                    }
                } catch (e) {
                    localStorage.removeItem('mo_current_session');
                }
            }
        }

        async function checkAuth() {
            const saved = localStorage.getItem('mo_current_session');
            if (!saved) return false;
            
            try {
                currentSession = JSON.parse(saved);
                sessionId = currentSession.sessionId;
                const doc = await db.collection('sessions').doc(sessionId).get();
                
                if (!doc.exists || !doc.data().active || new Date(currentSession.expiresAt) < new Date()) {
                    logout();
                    return false;
                }
                return true;
            } catch (e) {
                return false;
            }
        }

        // Dashboard Functions
        async function initDashboard() {
            document.getElementById('usernameDisplay').textContent = currentSession.name;
            document.getElementById('shortUrl').textContent = currentSession.captureUrl;
            
            startTimer();
            setupUsersListener();
            loadMessageHistory();
            setupCharCounter();
            setupMessagePreview();
        }

        function startTimer() {
            expiryTime = new Date(currentSession.expiresAt).getTime();
            updateTimer();
            timerInterval = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            const now = new Date().getTime();
            const distance = expiryTime - now;
            
            if (distance < 0) {
                clearInterval(timerInterval);
                document.getElementById('timerDisplay').textContent = "00:00";
                document.getElementById('expiredModal').classList.add('show');
                return;
            }
            
            const mins = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const secs = Math.floor((distance % (1000 * 60)) / 1000);
            document.getElementById('timerDisplay').textContent = 
                String(mins).padStart(2, '0') + ":" + String(secs).padStart(2, '0');
                
            if (mins < 2) document.getElementById('timerDisplay').classList.add('timer-low');
        }

        function setupUsersListener() {
            usersListener = db.collection('users')
                .where('sessionId', '==', sessionId)
                .onSnapshot(snapshot => {
                    const users = [];
                    snapshot.forEach(doc => users.push({ id: doc.id, ...doc.data() }));
                    users.sort((a, b) => (b.timestamp?.toMillis() || 0) - (a.timestamp?.toMillis() || 0));
                    updateUsersUI(users);
                });
        }

        function updateUsersUI(users) {
            const count = document.getElementById('usersCount');
            const container = document.getElementById('usersTableContainer');
            const rCount = document.getElementById('recipientCount');
            const rList = document.getElementById('recipientsList');
            const sendBtn = document.getElementById('sendBtn');
            
            if (users.length === 0) {
                count.textContent = 'No users registered';
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üì≠</div>
                        <p>No users registered in this session</p>
                    </div>`;
                rCount.textContent = 'No recipients available';
                rList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üì≠</div>
                        <p>No recipients captured</p>
                    </div>`;
                if (sendBtn) sendBtn.disabled = true;
                return;
            }
            
            count.textContent = `${users.length} users registered`;
            rCount.textContent = `${users.length} recipients available`;
            if (sendBtn) sendBtn.disabled = false;
            
            // Table
            let html = `<table class="users-table"><thead><tr>
                <th>Phone Number</th><th>Safety Code</th><th>Registered</th><th>Status</th>
            </tr></thead><tbody>`;
            
            users.forEach(u => {
                const date = u.timestamp ? u.timestamp.toDate().toLocaleString() : 'Just now';
                html += `<tr>
                    <td>${u.phone}</td>
                    <td style="color: var(--primary-yellow); font-family: monospace;">${u.safetyCode}</td>
                    <td>${date}</td>
                    <td><span class="status-badge status-${u.status === 'newly entered' ? 'new' : 'sent'}">${u.status}</span></td>
                </tr>`;
            });
            html += '</tbody></table>';
            container.innerHTML = html;
            
            // Recipients list
            rList.innerHTML = users.map(u => `
                <div class="recipient-item">
                    <div class="recipient-info">
                        <div class="recipient-phone">${u.phone}</div>
                        <div class="recipient-code">Safety Code: ${u.safetyCode}</div>
                    </div>
                    <input type="checkbox" class="recipient-checkbox" checked data-userid="${u.id}">
                </div>
            `).join('');
        }

        async function handleSend(e) {
            e.preventDefault();
            const content = document.getElementById('messageContent').value.trim();
            if (!content) return alert('Please enter a message');
            
            const checkboxes = document.querySelectorAll('.recipient-checkbox:checked');
            if (checkboxes.length === 0) return alert('Please select at least one recipient');
            
            const btn = document.getElementById('sendBtn');
            btn.innerHTML = '<span>‚è≥</span> Sending...';
            btn.disabled = true;
            
            const selected = Array.from(checkboxes).map(cb => cb.dataset.userid);
            let success = 0, failed = 0;
            
            for (const uid of selected) {
                try {
                    const doc = await db.collection('users').doc(uid).get();
                    if (!doc.exists) continue;
                    const user = doc.data();
                    const fullMsg = `${user.safetyCode} ${content}`;
                    
                    // Send via TextBelt
                    const response = await fetch(TEXTBELT_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            phone: user.phone.replace(/\D/g, ''),
                            message: fullMsg,
                            key: TEXTBELT_KEY
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success || result.textId) {
                        await db.collection('messages').add({
                            sessionId: sessionId,
                            recipient: user.phone,
                            safetyCode: user.safetyCode,
                            content: content,
                            fullMessage: fullMsg,
                            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                            status: 'sent',
                            textId: result.textId
                        });
                        
                        await db.collection('users').doc(uid).update({ 
                            status: 'sent',
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        success++;
                    } else {
                        console.error('TextBelt error:', result);
                        failed++;
                    }
                    
                    await new Promise(r => setTimeout(r, 1000)); // Rate limiting
                    
                } catch (err) {
                    console.error(err);
                    failed++;
                }
            }
            
            await loadMessageHistory();
            btn.innerHTML = '<span>üöÄ</span> Send Secure Message';
            btn.disabled = false;
            alert(`‚úÖ Sent to ${success} people! ${failed > 0 ? `(${failed} failed)` : ''}`);
        }

        async function loadMessageHistory() {
            const snapshot = await db.collection('messages')
                .where('sessionId', '==', sessionId)
                .orderBy('timestamp', 'desc')
                .get();
            
            const container = document.getElementById('messageHistory');
            const count = document.getElementById('messageCount');
            
            if (snapshot.empty) {
                count.textContent = 'No messages sent';
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üì§</div>
                        <p>No messages sent yet</p>
                    </div>`;
                return;
            }
            
            count.textContent = `${snapshot.size} messages sent`;
            let html = '';
            snapshot.forEach(doc => {
                const m = doc.data();
                const time = m.timestamp ? m.timestamp.toDate().toLocaleTimeString() : 'Just now';
                html += `
                    <div class="message-item">
                        <div class="message-header">
                            <span><strong>${m.recipient}</strong></span>
                            <span class="message-status"><span>‚úì</span> SENT</span>
                        </div>
                        <div class="message-content">
                            <span class="safety-prefix">${m.safetyCode}</span> ${m.content}
                        </div>
                        <div style="margin-top: 10px; font-size: 12px; opacity: 0.5;">${time}</div>
                    </div>`;
            });
            container.innerHTML = html;
        }

        function setupCharCounter() {
            document.getElementById('messageContent').addEventListener('input', function() {
                document.getElementById('charCount').textContent = this.value.length;
                const prev = document.getElementById('previewText');
                if (this.value.trim()) {
                    prev.innerHTML = `<span style="color: var(--primary-yellow); font-weight: 700;">[SafetyCode]</span> ${this.value}`;
                } else {
                    prev.innerHTML = `<span style="color: var(--primary-yellow); font-weight: 700;">[SafetyCode]</span> Your message will appear here...`;
                }
            });
        }

        function setupMessagePreview() {
            // Handled in char counter
        }

        function copyUrl() {
            const url = currentSession.captureUrl;
            navigator.clipboard.writeText(url).then(() => {
                const btn = document.querySelector('.btn-copy');
                btn.textContent = '‚úì Copied!';
                setTimeout(() => btn.textContent = 'Copy Link', 2000);
            });
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById('tab-' + tab).classList.add('active');
            document.getElementById('content-' + tab).classList.add('active');
        }

        // Capture Functions
        async function initCapture() {
            const params = new URLSearchParams(window.location.search);
            const sid = params.get('s');
            
            if (!sid || !sid.startsWith('sess_')) {
                showInvalidSession();
                return;
            }
            
            try {
                const doc = await db.collection('sessions').doc(sid).get();
                if (!doc.exists || !doc.data().active) {
                    showInvalidSession();
                    return;
                }
                
                // Setup form
                setupCaptureForm(sid);
                setupPhoneFormatting();
            } catch (e) {
                showInvalidSession();
            }
        }

        function showInvalidSession() {
            document.getElementById('registrationForm').style.display = 'none';
            document.getElementById('invalidSession').classList.add('show');
        }

        function setupCaptureForm(sid) {
            const form = document.getElementById('captureForm');
            form.onsubmit = async (e) => {
                e.preventDefault();
                
                const phone = document.getElementById('capPhone').value.trim();
                const phoneConf = document.getElementById('capPhoneConfirm').value.trim();
                const code = document.getElementById('capCode').value.trim();
                const codeConf = document.getElementById('capCodeConfirm').value.trim();
                
                // Validation
                document.querySelectorAll('.form-input').forEach(el => el.classList.remove('error'));
                document.querySelectorAll('.error-message').forEach(el => el.classList.remove('show'));
                
                let hasErr = false;
                if (phone !== phoneConf) {
                    document.getElementById('capPhone').classList.add('error');
                    document.getElementById('capPhoneConfirm').classList.add('error');
                    document.getElementById('phoneError').classList.add('show');
                    hasErr = true;
                }
                if (code !== codeConf) {
                    document.getElementById('capCode').classList.add('error');
                    document.getElementById('capCodeConfirm').classList.add('error');
                    document.getElementById('codeError').classList.add('show');
                    hasErr = true;
                }
                if (hasErr) return;
                
                try {
                    // Save user
                    await db.collection('users').add({
                        sessionId: sid,
                        phone: phone,
                        safetyCode: code,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                        status: 'newly entered'
                    });
                    
                    // Show success
                    document.getElementById('registrationForm').style.display = 'none';
                    document.getElementById('captureSuccess').classList.add('show');
                    document.getElementById('smsPreviewContent').innerHTML = 
                        `<span style="color: var(--primary-yellow); font-weight: 700;">${code}</span> Thank you for registering with Mobile Objex. Your secure messaging is now active.`;
                    
                    // Send confirmation SMS via TextBelt
                    const msg = `${code} Thank you for registering with Mobile Objex. Your secure messaging is now active.`;
                    await fetch(TEXTBELT_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            phone: phone.replace(/\D/g, ''),
                            message: msg,
                            key: TEXTBELT_KEY
                        })
                    });
                    
                } catch (err) {
                    console.error(err);
                    alert('Error saving registration');
                }
            };
        }

        function setupPhoneFormatting() {
            [document.getElementById('capPhone'), document.getElementById('capPhoneConfirm')].forEach(input => {
                if (!input) return;
                input.addEventListener('input', function(e) {
                    let val = e.target.value.replace(/\D/g, '');
                    if (val.length > 6) val = `(${val.slice(0,3)}) ${val.slice(3,6)}-${val.slice(6,10)}`;
                    else if (val.length > 3) val = `(${val.slice(0,3)}) ${val.slice(3)}`;
                    else if (val.length > 0) val = `(${val}`;
                    e.target.value = val;
                });
            });
        }

        // Demo Functions
        function initDemo() {
            const phone = document.getElementById('demoPhone');
            phone.addEventListener('input', function(e) {
                let val = e.target.value.replace(/\D/g, '');
                if (val.length > 6) val = `(${val.slice(0,3)}) ${val.slice(3,6)}-${val.slice(6,10)}`;
                else if (val.length > 3) val = `(${val.slice(0,3)}) ${val.slice(3)}`;
                else if (val.length > 0) val = `(${val}`;
                e.target.value = val;
            });
        }

        async function handleDemoSubmit(e) {
            e.preventDefault();
            const phone = document.getElementById('demoPhone').value.trim();
            const code = document.getElementById('demoCode').value.trim();
            const btn = document.getElementById('demoBtn');
            
            if (code.length < 4 || code.length > 6) {
                alert('Safety code must be 4-6 characters');
                return;
            }
            
            btn.classList.add('loading');
            btn.disabled = true;
            
            const msg = `${code} This is how verified messages from Mobile Objex appear. The Safe Key prefix authenticates legitimate communications and stops scams before they reach consumers.`;
            
            try {
                const res = await fetch(TEXTBELT_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        phone: phone.replace(/\D/g, ''),
                        message: msg,
                        key: TEXTBELT_KEY
                    })
                });
                
                const data = await res.json();
                
                if (data.success || data.textId) {
                    // Log to Firebase
                    await db.collection('verification_demos').add({
                        phone: phone,
                        safetyCode: code,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    document.getElementById('demoFormCard').style.display = 'none';
                    document.getElementById('demoSuccess').classList.add('show');
                    document.getElementById('demoPreviewCode').textContent = code;
                } else {
                    alert('Failed to send: ' + (data.error || 'Unknown error'));
                    btn.classList.remove('loading');
                    btn.disabled = false;
                }
            } catch (err) {
                console.error(err);
                alert('Network error');
                btn.classList.remove('loading');
                btn.disabled = false;
            }
        }

        function resetDemo() {
            document.getElementById('demoForm').reset();
            document.getElementById('demoFormCard').style.display = 'block';
            document.getElementById('demoSuccess').classList.remove('show');
            document.getElementById('demoBtn').classList.remove('loading');
            document.getElementById('demoBtn').disabled = false;
        }

        // Logout
        async function logout() {
            if (sessionId) {
                try {
                    await db.collection('sessions').doc(sessionId).update({ active: false });
                } catch(e) {}
            }
            if (usersListener) usersListener();
            localStorage.removeItem('mo_current_session');
            clearInterval(timerInterval);
            window.location.hash = '#login';
        }

        // Init
        window.addEventListener('hashchange', router);
        window.addEventListener('load', () => {
            loadTheme();
            router();
        });
    </script>
</body>
</html>
